DELIMITER $$

CREATE DEFINER=`pmotester`@`%` FUNCTION `FormatDateTime`(INDT DATETIME, INFORMAT VARCHAR(16)) RETURNS varchar(64) CHARSET latin1
BEGIN
  DECLARE DT VARCHAR(64);
  DECLARE MM_LEAD_ZERO, DD_LEAD_ZERO VARCHAR(1);
  DECLARE MIN_LEAD_ZERO VARCHAR(1);
  DECLARE DUMMY VARCHAR(5);
  DECLARE THEYEAR VARCHAR(4);
  IF MONTH(INDT) < 10  THEN SET MM_LEAD_ZERO = '0';
  ELSE SET MM_LEAD_ZERO = '';
  END IF;
  IF MINUTE(INDT) < 10  THEN SET MIN_LEAD_ZERO = '0';
  ELSE SET MIN_LEAD_ZERO = '';
  END IF;
  SET THEYEAR =  CAST(YEAR(INDT) AS CHAR);
  IF DAY(INDT) < 10  THEN SET DD_LEAD_ZERO = '0';
  ELSE SET DD_LEAD_ZERO = '';
  END IF;
  IF THEYEAR  = '1900' THEN
     RETURN '' ;
  END IF ;
  IF THEYEAR  = '0' THEN
     RETURN '' ;
  END IF ;
  CASE upper(INFORMAT)
  WHEN 'LONGDATE' THEN
          SET DUMMY = 'ARNE';
          RETURN 'long';
  WHEN 'SHORTDATE' then RETURN 'SHORTDATE';
  WHEN 'MM/YYYY' THEN
          SET DT =  CONCAT(MM_LEAD_ZERO, CAST(MONTH(INDT) AS CHAR), '/', CAST(YEAR(INDT) AS CHAR));
          RETURN DT;
  WHEN 'MM/DD/YYYY' THEN
          SET DT =  CONCAT(MM_LEAD_ZERO, CAST(MONTH(INDT) AS CHAR), '/', DD_LEAD_ZERO, CAST(DAY(INDT) AS CHAR), '/', CAST(YEAR(INDT) AS CHAR));
          RETURN DT;
  WHEN 'MMM/YY' THEN
          SET DT =  CONCAT(SUBSTR(MONTHNAME(INDT),1,3), '/', SUBSTR(CAST(YEAR(INDT) AS CHAR),3,2));
          RETURN DT;
  WHEN 'MM/DD/YY' THEN
          SET DT =  CONCAT(MM_LEAD_ZERO, CAST(MONTH(INDT) AS CHAR), '/', DD_LEAD_ZERO, CAST(DAY(INDT) AS CHAR), '/', SUBSTR(CAST(YEAR(INDT) AS CHAR),3,2));
          RETURN DT;
  WHEN 'MM/DD/YYYY HH:MM' THEN
          SET DT =  CONCAT(MM_LEAD_ZERO, CAST(MONTH(INDT) AS CHAR), '/', DD_LEAD_ZERO, CAST(DAY(INDT) AS CHAR), '/', CAST(YEAR(INDT) AS CHAR) , ' ' , CAST(HOUR(INDT) AS CHAR) , ':', MIN_LEAD_ZERO, CAST(MINUTE(INDT) AS CHAR));
          RETURN DT;
  WHEN 'YYYY/MM/DD' THEN
          SET DT =  CONCAT(CAST(YEAR(INDT) AS CHAR), '/', MM_LEAD_ZERO, CAST(MONTH(INDT) AS CHAR), '/', DD_LEAD_ZERO, CAST(DAY(INDT) AS CHAR));
          RETURN DT;

  ELSE      RETURN 'INV FRMT';
  END CASE;
  SET DT = '---';
  RETURN DT;
END
